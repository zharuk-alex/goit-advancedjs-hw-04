{"version":3,"file":"commonHelpers.js","sources":["../src/js/api-service.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_KEY = '5416463-3b798b4f634faaf9188b7760a';\n\nconst searchImages = ({ query, page, per_page = 40 }) => {\n  const params = new URLSearchParams({\n    key: API_KEY,\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page,\n    page,\n  });\n\n  return axios\n    .get('https://pixabay.com/api/', {\n      params,\n    })\n    .then(resp => {\n      if (resp.status !== 200) {\n        throw new Error(resp.statusText);\n      }\n\n      return resp.data;\n    });\n};\n\nexport { searchImages };\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.css';\n\nimport { searchImages } from './js/api-service';\n\nconst refs = {\n  header: document.querySelector('.header'),\n  nav: document.querySelector('.nav-list'),\n  form: document.querySelector('#search-form'),\n  btnSearch: document.querySelector('#search-form button[type=submit]'),\n  searchInput: document.querySelector('#search-form input[name=searchQuery]'),\n  gallery: document.querySelector('.gallery'),\n  btnLoadMore: document.querySelector('.load-more'),\n  loadMoreObserve: document.querySelector('.load-more-observe'),\n};\n\nconst observer = new IntersectionObserver(\n  entries => {\n    entries.forEach(entry => {\n      if (entry.isIntersecting && store.load_type === 'infinit_scroll') {\n        loadData();\n      }\n    });\n  },\n  {\n    root: null,\n    rootMargin: '300px',\n  }\n);\n\nconst store = new Proxy(\n  {\n    query: '',\n    page: 0,\n    per_page: 40,\n    is_loadable: false,\n    load_type: null, // loadmore, infinite scroll\n  },\n  {\n    set(target, property, value) {\n      const is_loadable =\n        property === 'is_loadable' ? value : target.is_loadable;\n      const load_type = property === 'load_type' ? value : target.load_type;\n\n      if (property === 'load_type') {\n        localStorage.setItem('load_type', load_type);\n\n        Array.from(refs.nav.querySelectorAll('.nav-link')).forEach(link => {\n          const { type } = link.dataset;\n          if (type === load_type) {\n            link.classList.add('active');\n          } else {\n            link.classList.remove('active');\n          }\n        });\n      }\n\n      if (load_type === 'loadmore' && is_loadable) {\n        refs.btnLoadMore.classList.remove('hidden');\n        observer.unobserve(refs.loadMoreObserve);\n      } else if (load_type === 'infinit_scroll' && is_loadable) {\n        refs.btnLoadMore.classList.add('hidden');\n        observer.observe(refs.loadMoreObserve);\n      } else {\n        refs.btnLoadMore.classList.add('hidden');\n        observer.unobserve(refs.loadMoreObserve);\n      }\n\n      target[property] = value;\n      return true;\n    },\n  }\n);\n\nstore.load_type = localStorage.getItem('load_type') ?? 'loadmore';\n\nconst lightboxInstance = new SimpleLightbox(`.gallery .photo-link`, {});\n\nconst enableBtnLoading = btnRef => {\n  btnRef.classList.add('loading');\n  btnRef.setAttribute('disabled', true);\n};\n\nconst disableBtnLoading = btnRef => {\n  btnRef.classList.remove('loading');\n  btnRef.removeAttribute('disabled');\n};\n\nconst scrollToElementWithOffset = id => {\n  setTimeout(() => {\n    const headerHeight = refs.header.offsetHeight;\n    const gap = parseInt(window.getComputedStyle(refs.gallery).gap);\n    const cardRef = refs.gallery.querySelector(`.photo-card[data-id=\"${id}\"]`);\n    const cardPosition = cardRef.getBoundingClientRect().top;\n    const offsetPosition = cardPosition - headerHeight - gap - gap / 2;\n\n    window.scrollBy({\n      top: offsetPosition,\n      behavior: 'smooth',\n    });\n  }, 500);\n};\n\nconst galleryItemMarkup = ({\n  id,\n  largeImageURL: original,\n  webformatURL: thumb,\n  tags: title,\n  likes,\n  views,\n  comments,\n  downloads,\n}) => {\n  return `\n  <div class=\"photo-card\" data-id=\"${id}\">\n    <a class=\"photo-link\" href=\"${original}\" >\n      <img src=\"${thumb}\" alt=\"${title}\" title=\"${title}\" loading=\"lazy\" />\n      <div class=\"info\">\n        <p class=\"info-item\">\n          <b>Likes</b>\n          ${likes}\n        </p>\n        <p class=\"info-item\">\n          <b>Views</b>\n          ${views}\n        </p>\n        <p class=\"info-item\">\n          <b>Comments</b>\n          ${comments}\n        </p>\n        <p class=\"info-item\">\n          <b>Downloads</b>\n          ${downloads}\n        </p>\n      </div>\n    </a>\n  </div>`;\n};\n\nconst loadData = () => {\n  store.page++;\n  const { page, per_page, query } = store;\n\n  return searchImages({\n    query,\n    page,\n    per_page,\n  })\n    .then(data => {\n      if (data.hits?.length === 0) {\n        throw new Error(\n          'Sorry, there are no images matching your search query. Please try again.'\n        );\n      }\n\n      if (page === 1) {\n        iziToast.success({\n          position: 'topRight',\n          message: `Hooray! We found ${data.totalHits} images.`,\n        });\n      }\n\n      const itemsMarkup = data.hits\n        .map(item => galleryItemMarkup(item))\n        .join('');\n\n      refs.gallery.insertAdjacentHTML('beforeend', itemsMarkup);\n\n      store.is_loadable = store.page * store.per_page < data.totalHits;\n      lightboxInstance.refresh();\n      return data;\n    })\n    .catch(error => {\n      console.error(error);\n      iziToast.error({\n        position: 'topRight',\n        message: error.message,\n      });\n    })\n    .finally(() => {\n      disableBtnLoading(refs.btnSearch);\n      disableBtnLoading(refs.btnLoadMore);\n    });\n};\n\nrefs.searchInput.addEventListener('input', function () {\n  if (this.value?.length) {\n    refs.btnSearch.removeAttribute('disabled');\n  } else {\n    refs.btnSearch.setAttribute('disabled', true);\n  }\n});\n\nrefs.form.addEventListener('submit', evt => {\n  evt.preventDefault();\n  store.page = 0;\n  refs.gallery.innerHTML = '';\n  enableBtnLoading(refs.btnSearch);\n  refs.btnLoadMore.classList.add('hidden');\n  store.query = refs.searchInput.value;\n  loadData();\n});\n\nrefs.btnLoadMore.addEventListener('click', () => {\n  enableBtnLoading(refs.btnLoadMore);\n  loadData().then(data => {\n    scrollToElementWithOffset(data.hits[0]?.id);\n  });\n});\n\nrefs.nav.addEventListener('click', evt => {\n  evt.preventDefault();\n  const { currentTarget, target } = evt;\n  if (currentTarget === target) {\n    return;\n  }\n\n  store.load_type = target.dataset.type;\n});\n"],"names":["API_KEY","searchImages","query","page","per_page","params","axios","resp","refs","observer","entries","entry","store","loadData","target","property","value","is_loadable","load_type","link","type","lightboxInstance","SimpleLightbox","enableBtnLoading","btnRef","disableBtnLoading","scrollToElementWithOffset","id","headerHeight","gap","offsetPosition","galleryItemMarkup","original","thumb","title","likes","views","comments","downloads","data","_a","iziToast","itemsMarkup","item","error","evt","currentTarget"],"mappings":"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"}